<!--
common.xml

Ant build file for logic common to every component.
All component build files inherit from this build file.
Download Apache Ant from http://ant.apache.org/.
Type "ant -p" for a list of targets.
-->

<project>
  <import file="${root.dir}/ant/global.xml"/>
  <property file="${root.dir}/ant/common.properties"/>

  <!-- Main build targets -->

  <target name="clean" description="remove all build files except artifacts">
    <delete dir="${build.dir}"/>
  </target>

  <!-- Internal build targets -->

  <target name="init-title">
    <echo>----------=========== ${component.name} ===========----------</echo>
  </target>

  <target name="init-timestamp">
    <tstamp>
      <format property="DATE" pattern="d MMMMM yyyy"/>
      <format property="YEAR" pattern="yyyy"/>
    </tstamp>
  </target>

  <target name="init-svn">
    <!-- determine SVN and version statistics -->
    <if>
      <isset property="svn.log"/>
      <else>
        <loadfile property="svn.entries" srcFile="${basedir}/.svn/entries"/>

        <propertyregex property="svn.revision"
          input="${svn.entries}" regexp="([^\n]*\n){3}([^\n]*)" select="\2"/>

        <propertyregex property="svn.url"
          input="${svn.entries}" regexp="([^\n]*\n){4}([^\n]*)" select="\2"/>

        <propertyregex property="svn.root"
          input="${svn.entries}" regexp="([^\n]*\n){5}([^\n]*)" select="\2"/>

        <propertyregex property="svn.date"
          input="${svn.entries}" regexp="([^\n]*\n){9}([^\n]*)" select="\2"/>

        <propertyregex property="svn.changed"
          input="${svn.entries}" regexp="([^\n]*\n){10}([^\n]*)" select="\2"/>

        <propertyregex property="release.version" defaultValue="trunk"
          input="${svn.url}" regexp=".*/branches/([^/]*).*"
          replace="dev \1"/>
        <propertyregex property="release.version" override="true"
          defaultValue="${release.version}"
          input="${svn.url}" regexp=".*/tags/loci-tools-([^/]*).*"
          replace="stable \1"/>
      </else>
    </if>
  </target>

</project>
