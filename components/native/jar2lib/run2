# Variables that need to be defined

# The base where everything you control is under

BASEDIR=${HOME}/tst3

# the path to the jni stuff

JNI_PATH=/Users/bselinsky/tst3/jace

# Path to any jars needed

JARSDIR=${BASEDIR}/jars

# Path to the Jar2Lib executable -- Also GetOpt

JAR2LIBPATH=/Users/bselinsky/svn/trunk/components/native/j2l5

# Path to the jace executable

MYJACEDIR=/Users/bselinsky/svn/trunk/components/native/j2l4/out/src/jace

# Path needed for javax/swing/awt

JAVAXPATH=/System/Library/Frameworks/JavaVM.framework/Versions/1.6.0/Classes/classes.jar

# Any extra cpp files outside those created

EXTRA_FILES=${JARSDIR}/jace1.1.1/source/c++/source/jace/JFieldHelper.cpp:\
${JARSDIR}/jace1.1.1/source/c++/source/jace/JClassImpl.cpp

# Class path used to run Jar2Lib

MAIN_CLASS_PATH=\
/System/Library/Frameworks/JavaVM.framework/Versions/1.6.0/Classes/classes.jar:\
out/src:\
${JAR2LIBPATH}:\
${JARSDIR}/loci-autogen.jar:\
${JARSDIR}/velocity-dep-1.5.jar:\
${JARSDIR}/jace1.1.1/source/java/classes:\
${JARSDIR}/retroweaver-2.0.7.jar:\
${JARSDIR}/retroweaver-rt-2.0.7.jar:\
${HOME}/bioFormats_src/trunk/components/native/bf-cpp/build/classes

# Class path passed to Jar2Lib

PASSED_CLASS_PATH=\
/System/Library/Frameworks/JavaVM.framework/Versions/1.6.0/Classes/classes.jar:\
${BASEDIR}/src/trunk/components/bio-formats/build/classes:\
${BASEDIR}/src/trunk/components/common/build/classes:\
${BASEDIR}/out/src:\
${JARSDIR}/bio-formats.jar:\
${JAVAXPATH}

#
# Dont change anything after this line
#

# Clean up old run

rm -rf ${BASEDIR}/out
mkdir ${BASEDIR}/out
mkdir ${BASEDIR}/out/header
mkdir ${BASEDIR}/out/source
mkdir ${BASEDIR}/out/src
mkdir ${BASEDIR}/out/src/include
mkdir ${BASEDIR}/out/src/source
mkdir -p ${BASEDIR}/out/src/libout/src

ln -s ${MYJACEDIR} ${BASEDIR}/out/src/include/jace

rm -rf ${BASEDIR}/src
mkdir ${BASEDIR}/src

# check out version of bioformats and compile it

cd ${BASEDIR}/src
svn co http://dev.loci.wisc.edu/svn/java/trunk
cd trunk
ant tools
cd ${BASEDIR}/src/trunk/components/native/bf-cpp
ant

cp -r ${BASEDIR}/src/trunk/components/native/bf-cpp/proxies/source/jace /Users/bselinsky/tst3/out/src/source

# Run Jar2Lib
# Actually create the proxies

cd ${BASEDIR}

java \
	-cp ${MAIN_CLASS_PATH} \
	Jar2Lib \
	-f fred \
	-s $1 \
	-h $1 \
	-H ${BASEDIR}/out/src \
	-S ${BASEDIR}/out/src \
	-C ${PASSED_CLASS_PATH} \
	-d x=java.lang.String \
	-c conflicts.txt \
	-I ${JARSDIR}/jace1.1.1/release/include \
	-L ${BASEDIR}/jace \
	-x ${EXTRA_FILES}

mkdir ${BASEDIR}/out/src/jace
cp ${BASEDIR}/jace/Prerequisites.cmake ${BASEDIR}/out/src/jace
cp ${JNI_PATH}/libjace.* ${BASEDIR}/out/src

mv CMakeLists.txt ${BASEDIR}/out/src

# Clean up naming issues

ed - ${BASEDIR}/out/src/jace/proxy/loci/formats/CoreMetadata.cpp <<!
29
a

#ifndef JACE_PROXY_JAVA_LANG_STRING_H
#include "jace/proxy/java/lang/String.h"
#endif
.
w
q
!

# Do the builds

cd ${BASEDIR}/out/src

/opt/local/bin/cmake .

make VERBOSE=1
